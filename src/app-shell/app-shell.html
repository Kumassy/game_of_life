<link rel="import" href="../../bower_components/polymer/polymer.html">

<!-- <link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/app-route/app-location.html"> -->
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">

<link rel="import" href="../life-app/life-app.html">
<link rel="import" href="../life-patterns/life-patterns.html">

<script src="../../bower_components/page/page.js"></script>

<dom-module id="app-shell">
  <template>
    <!-- app-location binds with the URL and produces a route for
    app-route elements to consume. Since this demo needs to run without
    server cooperation (e.g. with polyserve, in the elements catalog, etc) we'll
    use the hash portion of the URL for our route paths. -->
    <!-- <app-location route="{{route}}" use-hash-as-path></app-location> -->
    <!-- <app-location route="{{route}}"></app-location> -->


    <!-- app-routes parse route paths based on the their `pattern`.
    Parameters are extracted into the `data` object. The rest of the path that
    comes after the `pattern` is put into the `tail` object, which can be
    passed to the `route` property of downstream app-routes. -->
    <!-- <app-route route="{{route}}" pattern="/:page" data="{{data}}"></app-route> -->
    <!-- <app-route route="{{route}}" pattern="/" query-params="{{params}}"></app-route> -->

    <iron-pages attr-for-selected="data-route" selected="{{route}}">
      <section id="main" data-route="main">
        <life-app params="{{params}}" app="{{app}}">
        </life-app>
      </section>
      <section id="patterns" data-route="patterns">
        <h2>All Patterns</h2>
        <life-patterns current-page="[[params.page]]" app="{{app}}"></life-patterns>
      </section>
    </iron-pages>

  </template>

  <script>
    Polymer({
      is: 'app-shell',
      properties: {
        route: {
          // type: Object,
          type: String,
          // observer: '_routeChanged'
        },
        params: {
          type: Object
        },
        app: {
          type: Object,
          value: {}
        }
      },

      ready: function() {
        // console.log(this.route);

        var arg = {};
        var pair=location.search.substring(1).split('&');
        for(var i=0;pair[i];i++) {
            var kv = pair[i].split('=');
            arg[kv[0]]=kv[1];
        }
        this.params = arg;
        console.log(this.params);

        page.base('/life2');
        page('/', function(){
          this.route = 'main';
          console.log("main!!");
        }.bind(this));

        page('/patterns', function(){
          this.route = 'patterns';
          this.set('params.page', 0);
          console.log("patterns!!");
        }.bind(this));

        page('/patterns/page/:page', function(data){
          this.route = 'patterns';
          this.set('params.page', data.params.page);
          console.log(this.params.page);
          console.log("patterns!!");
        }.bind(this));
        page();
      },

      // _routeChanged: function(newValue, oldValue){
      //   // console.log(newValue);
      //
      // }
    });
  </script>
</dom-module>
